<!-- Page Header -->
<div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6">
  <div>
    <h1 class="text-2xl font-bold text-slate-900">Products</h1>
    <p class="text-sm text-slate-500 mt-0.5">Manage your inventory items</p>
  </div>
  <button
    (click)="navigateToCreate()"
    class="inline-flex items-center gap-2 px-4 py-2.5 bg-primary-600 text-white rounded-xl hover:bg-primary-700 transition-colors font-semibold text-sm shadow-sm"
  >
    <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
      <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
    </svg>
    Add Product
  </button>
</div>

<!-- Filters -->
<div class="flex flex-col sm:flex-row gap-3 mb-5">
  <div class="relative flex-1">
    <svg
      class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"
      fill="none"
      viewBox="0 0 24 24"
      stroke="currentColor"
      stroke-width="2"
    >
      <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-4.35-4.35M17 11A6 6 0 1 1 5 11a6 6 0 0 1 12 0z" />
    </svg>
    <input
      type="text"
      placeholder="Search by name or SKU..."
      (input)="onSearch($event)"
      class="w-full pl-9 pr-4 py-2 border border-slate-200 rounded-xl text-sm focus:ring-2 focus:ring-primary-500 focus:border-primary-500 outline-none bg-white"
    />
  </div>
  <select
    (change)="onCategoryFilter($event)"
    class="px-3 py-2 border border-slate-200 rounded-xl text-sm focus:ring-2 focus:ring-primary-500 outline-none bg-white text-slate-700 min-w-[160px]"
  >
    <option value="">All Categories</option>
    @for (cat of categories(); track cat.id) {
      <option [value]="cat.id">{{ cat.name }}</option>
    }
  </select>
</div>

<!-- Table -->
<div class="bg-white rounded-2xl border border-slate-100 shadow-sm overflow-hidden">
  @if (loading()) {
    <div class="flex items-center justify-center py-20">
      <div class="w-8 h-8 border-4 border-primary-200 border-t-primary-600 rounded-full animate-spin"></div>
    </div>
  } @else if (paginatedProducts().length === 0) {
    <div class="flex flex-col items-center justify-center py-20 text-slate-400">
      <svg
        class="w-12 h-12 mb-3 text-slate-300"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
        stroke-width="1.5"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"
        />
      </svg>
      <p class="text-sm font-medium">No products found</p>
      <p class="text-xs mt-1">Try adjusting your search or filter</p>
    </div>
  } @else {
    <div class="overflow-x-auto">
      <table class="w-full text-sm">
        <thead>
          <tr class="border-b border-slate-100 bg-slate-50/60">
            <th class="text-left px-4 py-3 text-xs font-semibold text-slate-400 uppercase tracking-wider">Product</th>
            <th class="text-left px-4 py-3 text-xs font-semibold text-slate-400 uppercase tracking-wider">SKU</th>
            <th class="text-left px-4 py-3 text-xs font-semibold text-slate-400 uppercase tracking-wider">Category</th>
            <th class="text-right px-4 py-3 text-xs font-semibold text-slate-400 uppercase tracking-wider">Stock</th>
            <th class="text-right px-4 py-3 text-xs font-semibold text-slate-400 uppercase tracking-wider">Price</th>
            <th class="text-center px-4 py-3 text-xs font-semibold text-slate-400 uppercase tracking-wider">Status</th>
            <th class="px-4 py-3"></th>
          </tr>
        </thead>
        <tbody class="divide-y divide-slate-50">
          @for (product of paginatedProducts(); track product.id) {
            <tr class="hover:bg-slate-50/50 transition-colors group">
              <td class="px-4 py-3">
                <button
                  (click)="navigateToDetail(product.id)"
                  class="font-medium text-slate-800 hover:text-primary-600 transition-colors text-left"
                >
                  {{ product.name }}
                </button>
                @if (product.location) {
                  <p class="text-xs text-slate-400 mt-0.5">{{ product.location }}</p>
                }
              </td>
              <td class="px-4 py-3">
                <span class="font-mono text-xs text-slate-500 bg-slate-100 px-2 py-0.5 rounded-md">
                  {{ product.sku }}
                </span>
              </td>
              <td class="px-4 py-3 text-slate-600">{{ getCategoryName(product.categoryId) }}</td>
              <td class="px-4 py-3 text-right">
                <span class="font-semibold text-slate-800">{{ product.currentStock }}</span>
                <span class="text-slate-400 text-xs ml-1">{{ product.unit }}</span>
                <p class="text-xs text-slate-400 mt-0.5">min {{ product.minimumStock }}</p>
              </td>
              <td class="px-4 py-3 text-right font-medium text-slate-700">${{ product.unitPrice.toFixed(2) }}</td>
              <td class="px-4 py-3 text-center">
                @if (product.currentStock === 0) {
                  <span
                    class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-semibold bg-red-100 text-red-700"
                  >
                    Out of stock
                  </span>
                } @else if (product.currentStock <= product.minimumStock) {
                  <span
                    class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-semibold bg-amber-100 text-amber-700"
                  >
                    Low stock
                  </span>
                } @else {
                  <span
                    class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-semibold bg-emerald-100 text-emerald-700"
                  >
                    In stock
                  </span>
                }
              </td>
              <td class="px-4 py-3">
                <div class="flex items-center justify-end gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                  <button
                    (click)="navigateToDetail(product.id)"
                    title="View detail"
                    class="p-1.5 text-slate-400 hover:text-primary-600 hover:bg-primary-50 rounded-lg transition-colors"
                  >
                    <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"
                      />
                    </svg>
                  </button>
                  <button
                    (click)="navigateToEdit(product.id)"
                    title="Edit"
                    class="p-1.5 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors"
                  >
                    <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"
                      />
                    </svg>
                  </button>
                  <button
                    (click)="deleteProduct(product.id)"
                    title="Delete"
                    class="p-1.5 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors"
                  >
                    <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
                      />
                    </svg>
                  </button>
                </div>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    @if (totalPages() > 1) {
      <div class="flex items-center justify-between px-4 py-3 border-t border-slate-100 bg-slate-50/40">
        <p class="text-xs text-slate-500">
          Showing {{ (currentPage() - 1) * pageSize + 1 }}â€“{{
            Math.min(currentPage() * pageSize, filteredProducts().length)
          }}
          of {{ filteredProducts().length }} products
        </p>
        <div class="flex items-center gap-1">
          <button
            (click)="currentPage.set(currentPage() - 1)"
            [disabled]="currentPage() === 1"
            class="px-3 py-1.5 text-xs font-medium text-slate-600 border border-slate-200 rounded-lg hover:bg-slate-100 disabled:opacity-40 disabled:cursor-not-allowed transition-colors"
          >
            Previous
          </button>
          @for (page of [].constructor(totalPages()); track $index) {
            <button
              (click)="currentPage.set($index + 1)"
              [class]="
                currentPage() === $index + 1
                  ? 'px-3 py-1.5 text-xs font-semibold bg-primary-600 text-white rounded-lg'
                  : 'px-3 py-1.5 text-xs font-medium text-slate-600 border border-slate-200 rounded-lg hover:bg-slate-100 transition-colors'
              "
            >
              {{ $index + 1 }}
            </button>
          }
          <button
            (click)="currentPage.set(currentPage() + 1)"
            [disabled]="currentPage() === totalPages()"
            class="px-3 py-1.5 text-xs font-medium text-slate-600 border border-slate-200 rounded-lg hover:bg-slate-100 disabled:opacity-40 disabled:cursor-not-allowed transition-colors"
          >
            Next
          </button>
        </div>
      </div>
    }
  }
</div>
